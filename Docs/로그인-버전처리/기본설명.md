
# 개발 가이드 :: 로그인 버전처리


## [로그인]
키움OpenAPI는 로그인창을 통해 접속(로그인) 합니다.  
보안정책 강화로 인해 사용자의 로그인계정을 암호화하기 위해 로그인창이 사용됩니다.  
소스상으로 고객의 비밀번호를 평문으로 입력받지 않도록 설계되었습니다.


## [로그인 사용법]
로그인은 CommConnect()함수를 호출합니다. 키움OpenAPI가 제공하는 로그인창이 실행됩니다.  
ID/Pw 입력 후 로그인완료시 OnEventConnect 이벤트가 발생됩니다.  
OnEventConnect 이벤트의 인자값으로 로그인 성공여부를 알수 있습니다.  
이 값이 0이면 성공이고 나머지는 실패로 오류코드값을 수신합니다.

    CommConnect(사용자 호출) -> 로그인창 출력 -> OnEventConnect(이벤트 발생)


## [수동 로그인]
로그인창에 로그인ID와 비밀번호를 직접 입력해서 로그인 하는것을 말합니다.  
수동 로그인중에 버전처리(최신파일 업데이트)내용이 있는 경우 버전처리도 함께 진행됩니다.


## [계좌비밀번호 설정]
OpenAPI는 로그인 후 한번 계좌비밀번호를 입력/등록 해야 합니다.  
계좌비밀번호 설정은 계좌비밀번호 입력창을 통해서만 가능합니다.  
이 입력창을 출력하는 방법은 2가지로 제공됩니다.  
1. 메뉴이용 - 로그인후 윈도우의 작업표시줄상에 깜박이는 트레이아이콘의  
마우스우측 메뉴(모니터 오른쪽 하단)에서 "계좌비밀번호 저장" 선택  
2. 함수이용 - 로그인후 OpenAPI.KOA_Functions(_T("ShowAccountWindow"), _T("")) 호출

### ※ 계좌비밀번호 입력시 주의할 점 :
OpenAPI는 계좌비밀번호를 검증하지 않고 입력된 값을 그대로 암호화하여 서버로 전송합니다.  
계좌비밀번호 오류가 일어나지 않도록 오타 등 입력에 주의하시기 바랍니다.


## [자동 로그인]
로그인 후에 계좌비밀번호 입력창을 통해 자동로그인을 설정할 수 있습니다.  
계좌비밀번호 입력창에서 계좌비밀번호를 입력하고 "등록" 또는 "전체등록" 버튼을 눌러서  
비밀번호를 저장한 다음 아래에 있는 "AUTO" 옵션을 체크하면 자동 로그인을 위한 설정이 모두 끝납니다.  
다음번 실행부터 로그인시 로그인창에 계정 입력하는 과정 없이 로그인과정이 자동으로 실행됩니다.  
자동로그인시에는 버전처리(최신파일 업데이트) 과정을 생략합니다.  
단 거래소로부터 수신되는 Daily배치 파일인 종목정보 파일은 자동로그인시에도 다운받습니다.

### ※ 자동로그인 사용시 주의할 점 :

정기적으로 일주일에 한번 이상 자동로그인 해지 후 수동로그인으로 버전처리를 받아주시길 권장드립니다.  
버전처리 없이 자동로그인을 계속 사용시에 예기치 않은 오동작의 가능성이 있습니다.  
장종료 후 혹은 주말에도 버전처리는 정상 수행됩니다.  


## [버전 처리(최신파일 다운로드)]
OpenAPI의 업데이트가 있는 경우  
로그인할때 버전처리 알림창이 출력 됩니다.  
이 알림창이 표시되면 실행한 OpenAPI프로그램(KOA스튜디오포함)을  
먼저 모두 종료한다음 알림창에 있는 확인버튼을 눌러야 합니다.  
그렇지 않으면 버전처리가 정상적으로 끝나지 않아서 로그인할때마다 버전처리 알림창이 반복됩니다.  
이렇게 OpenAPI프로그램을 모두 종료한 다음 알림창을 닫아주면  
버전처리가 자동으로 진행/완료 되고 종료했던 프로그램을 재실행 해주면 됩니다.  
버전처리가 정상적으로 완료된 이후에는 다음번 버전처리가 있을때까지 접속시 해당 알림창이 실행되지 않습니다.


## [필수 버전처리 (자동로그인 강제해지)]
OpenAPI 운영시 사용자가 필수적으로 버전처리를 받아야 하는 업데이트가 있는 경우,  
버전처리를 위해 자동로그인이 강제 해지되는 기능이 작동할 수 있습니다.  
(이때 버전처리완료 후 접속하여 자동로그인을 재설정하실 수 있습니다.)  
자동로그인이 강제해지되는 업데이트는 사용자의 불편함을 줄일 수 있도록 최소화하여 운영됩니다.


## [모의투자]
로그인 창에서 모의투자접속에 체크하면 모의투자로 접속하며 이 체크를 풀면 실거래 서버로 접속합니다.  
(KOA Studio 프로그램은 모의투자로만 접속가능합니다. 따라서 모의투자접속 체크 해지가 되지 않습니다.)  
모의투자 접속은 (상시)모의투자 신청 이후에 가능하며 신청여부는 영웅문4 HTS의 모의투자 신청여부와 공유됩니다.  
모의투자 계좌번호, 주문 가능종목, 수수료등 규정은 실거래 시스템과 차이가 있으며 아래 주소에서 확인 가능합니다.  
https://www.kiwoom.co.kr/nkw.templateFrameSet.do?m=m1101020000


## [중복로그인]
OpenAPI는 보안정책으로 인해 동일ID에대한 중복로그인을 허용하지 않습니다.  
동일한ID로 중복로그인시에 마지막 로그인한 접속만 유지되고 이전에 로그인한 접속은 단절됩니다.  
모의투자서버 로그인 역시 중복로그인을 허용하지 않습니다.  
(동일한 ID로 실거래서버 로그인과 모의투자로 중복로그인은 가능합니다.)  
동일한ID로 OpenAPI, 영웅문 HTS, MTS 의 중복로그인이 가능합니다.  
동일PC에서 서로다른 ID로 복수실행이 가능합니다.  
다만 OpenAPI 실행에 필요한 파일에 동시에 접근하면서 오동작을 일으킬 수 있습니다.  
하나의 PC에서 하나의 실행을 권장합니다.
