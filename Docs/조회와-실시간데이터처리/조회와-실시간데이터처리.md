
# 개발 가이드 :: 조회와 실시간데이터처리

## [조회처리(조회요청)]
OpenAPI가 제공하는 데이터중에서 원하는 데이터를 서버에 요청해서 수신 받는 것을 말합니다.  
이는 하나의 TR(Transaction)단위로 처리됩니다.  
각 TR은 서버와 데이터를 주고받을때 약속된 규약입니다.  
각각의 TR은 입력부분(Input)과 출력부분(Output)을 가지고 있습니다.  
Input은 사용하는 TR에따라 항목이 달라지며 사용자(고객)가 입력해야 하는 부분이고,  
Output은 요청에대한 서버의 응답으로 수신되는 데이터 입니다.  
Output은 여러항목으로 제공되며 필요한 항목의 값만을 골라서 얻을 수 있습니다.

출력부분은 항목이 하나로 전달되는 싱글데이터와 복수의 건수로 전달되는 멀티데이터가 있습니다.  
TR에 따라 싱글데이터(또는 멀티데이터)만 있거나 둘다 있는 경우도 있습니다.

    OPT10070 : 당일주요거래원요청 - 싱글데이터  
    OPT10081 : 주식일봉차트조회요청 - 싱글 + 멀티데이터

OpenAPI가 제공하는 TR들은 KOA Studio의 "TR목록" 탭에서 찾아볼 수 있습니다.  
이중 필요한 TR을 선택하여 약속된 Input값을 입력 후 서버에 요청하면  
해당 TR에 정의되어 있는 Output 항목들의 값을 구할 수 있습니다.

### ※ 주의할 점 :
조회시 입력값 항목들은 SetInputValue 함수로 반드시 순서에 맞게 입력해야 합니다.  
계좌비밀번호는 별도의 입력창으로 입력/등록하고 조회시에는 공백으로 입력합니다.  

    ex) SetInputValue("비밀번호"	,  "");


## [조회요청/수신 사용법]
조회요청하고자 하는 TR의 입력값(input)을 셋팅한뒤 조회요청을 합니다.  
서버는 요청에대한 결과를 보내주고 이벤트를 발생시켜 데이터를 수신합니다.  
수신한 데이터중 필요한 항목에 해당하는 값을 구합니다.

    SetInputValue(사용자 호출) -> CommRqData(사용자 호출) -> OrderResultTrData(이벤트 발생)


## [연속조회]
TR별로 한번에 전달할 수 있는 데이터 갯수가 정해져 있습니다.  
이 갯수보다 조회할 데이터가 많을때는 연속조회로 모든 데이터를 조회할 수 있습니다.  
연속조회는 CommRqData()에서 인자값만 바꿔서 다시 요청합니다.

    CommRqData("일별데이터조회", "OPT10086" , 0, "0001");      
    위처럼 요청한 데이터가 한번에 수신된 데이터보다 더 많이 있다면
    OnReceiveTRData()이벤트에서 5번째 인자값(sPrevNext)에 "2"가 전달됩니다.
    
    이때 더 많은 데이터를 요청하고자 할때는
    CommRqData("일별데이터조회", "OPT10086" , 2, "0001");
    위처럼 3번째 인자값을 2로 설정해서 조회하시면 됩니다.
    
    정리하면 다음과 같습니다.
    OpenAPI.CommRqData("일별데이터조회", "OPT10086" , 0, "0001"); // 처음조회시 혹은 연속데이터가 없을때
    OpenAPI.CommRqData("일별데이터조회", "OPT10086" , 2, "0001"); // 연속조회시 (필요에따라 요청)

### ※ 주의할 점 :
중간에 다른 TR 요청이 있는 경우 연속조회가 되지 않습니다.


## [실시간 데이터]
시세조회요청이 성공하면 해당종목의 실시간시세 데이터가 서버에 자동으로 등록됩니다.  
이후 해당종목의 실시간 시세데이터는 OnReceiveRealData() 이벤트로 수신됩니다.  
또는 시세조회가 필요없고 실시간시세만 필요한 경우는  
SetRealReg 함수를 사용하여 특정종목(복수종목 가능)의 실시간시세를 서버에 등록할 수 있습니다.

※ SetRealReg() 함수는 조건검색 항목에서 사용법을 설명하고 있습니다.

KOA Studio의 실시간 탭을 여시면 Real Type (실시간타입) 목록을 확인할 수 있습니다.  
이들 하나하나를 실시간 타입이라고 합니다.  
각 실시간타입에 포함되는 데이터항목들의 FID(Feild ID)들이 그룹핑되어 있습니다.  
예를들어 실시간 타입 "주식시세"는 FID 10 현재가 ~ FID 568 하한가발생시간까지 FID로 구성되며 한꺼번에 전달됩니다.  
또 실시간 타입 "주식체결"는 FID 20 체결시간 ~ FID 1313 Extra Item까지 FID가 한번에 전달됩니다.


## [실시간시세 사용법]
시세관련 TR서비스를 요청하는 경우 자동으로 서버에 해당 종목의 실시간시세가 등록 됩니다.  
시세관련 TR서비스 조회요청이 불필요한 경우 SetRealReg 함수를 통해 조회없이 실시간시세 등록이 가능합니다.

방법1. 조회 서비스 이용

    SetInputValue(사용자 호출) -> CommRqData(사용자 호출) -> OrderResultTrData(이벤트 발생) ->OnReceiveRealData(이벤트 발생)

방법2. SetRealReg 함수 이용

    SetRealReg(사용자 호출) -> OnReceiveRealData(이벤트 발생)


## [주문관련 실시간 데이터]
실시간 타입 "주문체결", "잔고", "파생잔고"는 주문관련 실시간 데이터를 전달합니다.
데이터요청이나 서버등록 필요없이 주문발생시 수신되는 실시간타입 입니다.
실시간시세와는 다르게 조회요청이나 SetRealReg() 함수로 등록해서 사용할 수 없습니다.
수신 이벤트는 OnReceiveChejanData() 입니다.
영웅문4 HTS, 영웅문S MTS 를 통한 주문들도 동일ID로 접속한 경우 OpenAPI로 수신됩니다.


아래 실시간 타입은 시스템 내부용으로, 사용자가 사용할수 없는 실시간 타입입니다.
1. 임의연장정보
2. 시간외종목정보
3. 주식거래원
4. 순간체결량
5. 선물옵션합계
6. 투자자별매매
